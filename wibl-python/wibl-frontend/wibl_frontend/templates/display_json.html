<!DOCTYPE html>
<html>
<head>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .delete-checkbox {
            text-align: center;
        }

        .expandable-row {
            cursor: pointer;
        }

        .details-row {
            display: none;
        }

        .details-row td {
            background-color: #eaeaea; /* Alternate background color for details row */
        }
    </style>
</head>
<body>
   <h1 class="logo">Results:</h1>

   <!-- File Query Form -->
   <form id="deleteForm" method="POST" action="/home" enctype="multipart/form-data">

    <label for="upload_id">Enter Upload ID for Metadata File (use 'all' to view all entries):</label>
    <input type="text" name="upload_id" required>

    <label for="loggers">Choose a logger to view:</label>
    <select name="loggers" id="loggers" multiple>

      {% for logger, logger_val in loggers %}
        <option value="{{ logger }}">{{ logger }}  {{ logger_val }} Files(s)</option>
      {% endfor %}

    </select>
    <br>
    <input type="submit" value="Submit Filters">
   </form>

    <table id="dataTable">
      <thead>
        <tr>
          <th class="delete-checkbox">Delete?</th>
          <th>File Name</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in data %}
        <tr class="expandable-row">
          <td class="delete-checkbox"><input type='checkbox' name="fileDelete" class="fileDelete"></td>
          <td>{{entry.fileid}}</td>
          <td>{{entry.starttime}}</td>
        </tr>
        <tr class="details-row">
          <td colspan="3">
            <div>
              Logger: {{ entry.logger }}<br>
              Vessel: {{ entry.platform }}<br>
              Size: {{ entry.size }}<br>
              Soundings: {{ entry.soundings }}<br>
              Observations: {{ entry.observations }}<br>
              Start Time: {{ entry.starttime }}<br>
              End Time: {{ entry.endtime }}<br>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <button id="deleteButton">Delete Selected Files</button>

    <script>
    const deleteButton = document.getElementById("deleteButton");
    deleteButton.addEventListener("click", () => {
        const checkboxes = document.querySelectorAll("input[name='fileDelete']:checked");
        if (checkboxes.length > 0) {
            const confirmDelete = confirm("Are you sure you want to delete these files?");
            if (confirmDelete) {
                checkboxes.forEach(checkbox => {
                    const row = checkbox.closest("tr");
                    const fileName = row.querySelector("td:nth-child(2)").innerText;
                    deleteFile(fileName);
                });
            }
        } else {
            alert("No Files Selected.");
        }
    });

    const expandableRows = document.querySelectorAll(".expandable-row");
    expandableRows.forEach((row, index) => {
        if (index % 2 === 0) {
            row.style.backgroundColor = "#f9f9f9"; /* Lighter color for even rows */
        }
        row.addEventListener("click", () => {
            const detailsRow = row.nextElementSibling;
            detailsRow.classList.toggle("details-row");
        });
    });

    function deleteFile(fileName) {
        fetch('/home', {
            method: 'DELETE',
            headers: {
                "Content-Type": "text/plain"
            },
            body: fileName
        })
        .then(response => {
            if (response.ok) {
                // Remove the row from the table
                const row = document.querySelector(`td:contains(${fileName})`).parentNode;
                row.parentNode.removeChild(row);
                alert(`File ${fileName} deleted successfully.`);
            } else {
                throw new Error('Error deleting file.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    </script>
 </body>
</html>
