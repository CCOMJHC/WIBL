<!doctype html>
<html lang="en-US">
  {% load static %}
  <head>
    <meta charset="utf-8" />
    <title>WIBL Frontend</title>
  </head>
  <body>
    <p>Message: {{ message }}</p>

    <div>
        WIBL files...
        <ul id="wibl-file-list">

        </ul>
    </div>

    <script src="{% static 'frontend/js/SocketManager.js' %}"></script>

    <script language="JavaScript">
        function testWiblHandlerListWiblFiles(message) {
            console.log("In testWiblHandlerListWiblFiles...");
            for (const wiblFile of message.message.files) {
                const fileName = wiblFile.fileid;
                console.log(`Filename: ${fileName}`);
                const li = document.createElement("li");
                li.setAttribute("id", `wibl-file-${fileName}`);
                li.textContent = fileName;
                wiblFileList.appendChild(li);
            }
        }

        console.log("In script...");
        const wiblFileList = document.getElementById("wibl-file-list");
        var dataRequested = false;
        //const sock = new WebSocket('ws://' + window.location.host + '/ws/wibl/');

        sock = new SocketManager('ws://' + window.location.host + '/ws/wibl/');
        sock.addHandler("list-wibl-files", testWiblHandlerListWiblFiles);
        sock.sendRequest("list-wibl-files");

    </script>
  </body>
</html>
